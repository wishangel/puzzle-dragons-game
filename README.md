# パズル&ドラゴンズ風パズルゲーム - 完全版

パズル&ドラゴンズのパズル部分を完全再現したWebゲームです。

## 🎮 機能

### 基本機能
- **直感的な操作**: スマホとPCの両方で快適にプレイ可能
- **ドロップの種類選択**: 火・水・木・光・闇・回復から自由に選択
- **連鎖システム**: 3つ以上揃えると消去、自動で連鎖を検出
- **美しいビジュアル**: 実際のドロップ画像を使用したリアルな表現
- **カスタマイズ可能**: ボードサイズを変更可能（5×4、6×5、7×6）

### 拡張機能 ✨

#### 🎯 タイムアタックモード
- 60秒間の制限時間内でスコアを競う
- リアルタイムでカウントダウン表示
- タイムアップ時に自動的にスコア表示

#### ⚡ スキルシステム
- **全消しスキル**: ボード上のすべてのドロップを新しいドロップに変換
- **変換スキル**: 特定の色のドロップを別の色に変換
- クールダウンシステム（コンボを重ねることで再使用可能）

#### 🎨 盤面編集モード **NEW!**
- 「盤面編集モード」ボタンで編集モードに切り替え
- パレットから配置したいドロップを選択
- クリックまたはドラッグでドロップを自由に配置
- 画像読み込み後の微調整にも使用可能

#### 📸 画像読み込み機能 **NEW!**
- スマホのスクリーンショットから盤面を自動認識
- HSV色空間とRGB解析によるドロップタイプの高精度判定
- 読み込み後、編集モードで手動調整が可能

#### 🧭 アシストルート機能 **NEW!**
- ビームサーチアルゴリズムによる最適ルート探索
- アニメーション付きでルートを表示
- コンボ数を表示し、10秒間ルートを確認可能

#### 🏆 オンラインランキング **NEW!**
- Firebase Firestore連携によるリアルタイムランキング
- 通常モードとタイムアタックモードで個別のランキング
- 名前とスコアを登録し、他のプレイヤーと競える

#### 🔊 サウンド & BGM
- ドロップ移動時の効果音
- 消去時の効果音
- コンボ達成時の効果音
- スキル発動時の効果音
- インストゥルメンタルBGM
- サウンドとBGMの個別ON/OFF切り替え可能

#### 🏆 ハイスコアシステム
- LocalStorageを使用した永続的なハイスコア保存
- 通常モードとタイムアタックモードで個別に記録
- ゲーム画面に常時表示

## 🚀 プレイ方法

### 基本操作
1. ドロップをドラッグして移動（6秒以内）
2. 同じ色のドロップを3つ以上揃える
3. 連鎖を繋げて高得点を狙おう！

### スキルの使い方
1. コンボを決めてスキルのクールダウンを減らす
2. クールダウンが0になったらスキルボタンをクリック
3. 効果的にスキルを使って高得点を狙おう！

### タイムアタックモード
1. 「タイムアタック開始」ボタンをクリック
2. 60秒以内にできるだけ高いスコアを目指す
3. タイムアップ後、3000点以上でランキング登録可能

### 盤面編集モード
1. 「盤面編集モード」ボタンをクリック
2. パレットから配置したいドロップを選択
3. 盤面をクリックまたはドラッグして配置
4. 「編集終了」ボタンで通常モードに戻る

### 画像読み込み
1. 「画像から盤面を読込」ボタンをクリック
2. スマホのスクリーンショットを選択
3. 自動的に盤面を解析・反映
4. 必要に応じて編集モードで微調整

### アシストルート
1. 「アシストルート」ボタンをクリック
2. 最適なルートを自動計算（数秒かかります）
3. アニメーション付きでルートを確認
4. 10秒後に自動的に非表示

## 🛠️ 技術スタック

- **HTML5 Canvas**: ゲームボードの描画
- **CSS3**: グラデーション、アニメーション、グラスモーフィズム
- **Vanilla JavaScript (ES6+)**: ゲームロジック
- **Web Audio API**: サウンドエフェクト
- **LocalStorage API**: ハイスコア保存
- **Firebase Firestore**: オンラインランキング
- **画像解析**: HSV/RGB色空間での高精度ドロップ判定
- **ビームサーチ**: 最適ルート探索アルゴリズム

## 📦 セットアップ

### 1. リポジトリのクローン
```bash
git clone <your-repo-url>
cd PuzzleAndDragon
```

### 2. Firebaseの設定（オンラインランキング用）
1. [Firebase Console](https://console.firebase.google.com/)でプロジェクトを作成
2. Firestoreデータベースを有効化
3. `firebase-manager.js`に認証情報を設定

### 3. ローカルサーバーの起動
```bash
# Python 3の場合
python -m http.server 8000

# Node.jsの場合
npx serve
```

### 4. ブラウザでアクセス
```
http://localhost:8000
```

## 🌐 デプロイ

### GitHub Pages
```bash
# リポジトリをGitHubにプッシュ
git init
git add .
git commit -m "feat: Complete Puzzle & Dragons game with all features"
git branch -M main
git remote add origin <your-repo-url>
git push -u origin main

# GitHub Pagesを有効化
# Settings > Pages > Source: main branch
```

### Netlify / Vercel
ドラッグ&ドロップでデプロイ可能

## 🎯 カスタマイズ

### ドロップの種類を変更
ゲーム画面のドロップ選択UIで、利用するドロップを選択できます。

### ボードサイズを変更
設定パネルから5×4、6×5、7×6のいずれかを選択できます。

### ドロップ画像の追加
`img/`ディレクトリに新しい画像を追加し、`script.js`の`orbColors`オブジェクトを更新してください。

### BGMの変更
`music/`ディレクトリに新しいBGMファイルを追加し、`script.js`の`bgmPath`を更新してください。

## 📁 ファイル構成

```
PuzzleAndDragon/
├── index.html                # メインHTML
├── style.css                 # スタイルシート
├── orb-preview-override.css  # ドロッププレビュー用CSS
├── script.js                 # ゲームロジック
├── firebase-manager.js       # Firebase連携
├── bgm-control.js           # BGM制御
├── img/                      # ドロップ画像
│   ├── fire.png
│   ├── water.png
│   ├── wood.png
│   ├── light.png
│   ├── dark.png
│   └── heal.png
├── music/                    # BGMファイル
│   └── bgm_instrumental.mp4
├── refs/                     # 参照画像
│   ├── drop1.png
│   └── drop2.png
├── README.md                 # このファイル
├── DEPLOY.md                 # デプロイ手順
└── .gitignore               # Git設定
```

## ✨ 実装済み機能一覧

- ✅ **基本パズルゲーム**: ドラッグ操作、連鎖、コンボ
- ✅ **タイムアタックモード**: 60秒間の制限時間
- ✅ **サウンドエフェクト**: Web Audio API使用
- ✅ **BGM**: オン/オフ切り替え可能
- ✅ **ハイスコア保存**: LocalStorageで永続化
- ✅ **スキルシステム**: 全消し、変換スキル
- ✅ **実際のドロップ画像**: 6種類のドロップ
- ✅ **盤面編集モード**: 自由にドロップを配置
- ✅ **画像読み込み**: スクリーンショットから自動認識
- ✅ **アシストルート**: 最適ルート探索とアニメーション表示
- ✅ **オンラインランキング**: Firebase連携

## 🎨 デザイン特徴

- モダンなグラデーション配色
- グラスモーフィズム効果
- スムーズなアニメーション
- レスポンシブデザイン
- 各ボタンの統一感のある配色
  - タイムアタック: 緑グラデーション
  - アシストルート: ピンク/紫グラデーション
  - 画像読込: 青グラデーション
  - 盤面編集: オレンジ/ピンクグラデーション
  - リセット: 赤グラデーション
  - ランキング: インディゴグラデーション

## 🚧 今後の拡張案

- モンスター表示システム
- より複雑なスキルシステム（変身、覚醒スキルなど）
- パーティー編成機能
- ダンジョンモード
- リプレイ機能
- マルチプレイヤー対戦

## 🐛 既知の問題

現在、既知の問題はありません。問題を発見した場合は、Issuesに報告してください。

## 📄 ライセンス

MIT License

## 🙏 謝辞

このプロジェクトは「パズル&ドラゴンズ」にインスパイアされて作成されました。
すべてのゲームロジックとアルゴリズムはオリジナル実装です。